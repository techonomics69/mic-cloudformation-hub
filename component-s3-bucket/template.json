{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "AWS S3 Bucket",
    "Parameters": {
        "bucketName": {
            "Type": "String",
            "Default": "",
            "Description": "The name of the bucket. If bucket name is not specified then the name will be auto-generated."
        },
        "accessControl": {
            "Type": "String",
            "Description": "Access control that grants permissions to the bucket",
            "Default": "Private",
            "AllowedValues": [
                "Private",
                "PublicRead",
                "PublicReadWrite",
                "AuthenticatedRead",
                "LogDeliveryWrite",
                "BucketOwnerRead",
                "BucketOwnerFullControl",
                "AwsExecRead"
            ]
        }
    },

    "Conditions": {
        "NamedBucket": {"Fn::Not": [{"Fn::Equals" : [{"Ref" : "bucketName"}, ""]}]},
        "AutoGeneratedBucketName": {"Fn::Equals" : [{"Ref" : "bucketName"}, ""]}
    },

    "Resources": {
        "S3Bucket": {
            "Type": "AWS::S3::Bucket",
            "Condition": "AutoGeneratedBucketName",
            "Properties": {
                "AccessControl": {
                    "Ref": "accessControl"
                },
                "BucketEncryption": {
                    "ServerSideEncryptionConfiguration": [{
                        "ServerSideEncryptionByDefault": {
                            "SSEAlgorithm" : "AES256"
                        }
                    }]
                }
            }
        },
        "NamedS3Bucket": {
            "Type": "AWS::S3::Bucket",
            "Condition": "NamedBucket",
            "Properties": {
                "BucketName": {"Ref": "bucketName"},
                "AccessControl": {
                    "Ref": "accessControl"
                },
                "BucketEncryption": {
                    "ServerSideEncryptionConfiguration": [{
                        "ServerSideEncryptionByDefault": {
                            "SSEAlgorithm" : "AES256"
                        }
                    }]
                }
            }
        }
    },
    "Outputs": {
        "bucketName": {
            "Value": {
                "Fn::If": ["NamedBucket", {"Ref": "NamedS3Bucket"}, {"Ref": "S3Bucket"}]
            },
            "Description": "Name of the S3 bucket"
        }
    }
}
